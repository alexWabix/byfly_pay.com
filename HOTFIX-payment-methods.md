# Hotfix - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã

**–î–∞—Ç–∞**: 25.12.2025  
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ–ø–ª–∞—Ç—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üêõ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–ø–ª–∞—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–º (`/pay/{transaction_id}`) –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã. –û—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ "–û–ø–ª–∞—Ç–∏—Ç—å ‚Ç∏" –±–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—ã–±–æ—Ä–∞.

**–ü—Ä–∏—á–∏–Ω–∞:**
1. –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/payment-methods/active` –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è —Ä–æ—É—Ç–µ—Ä–æ–º
2. –ú–∞—Å—Å–∏–≤ `$pathParts` –≤ `api/index.php` –Ω–µ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–ª—Å—è –ø–æ—Å–ª–µ `array_filter()`, –∏–∑-–∑–∞ —á–µ–≥–æ –∫–ª—é—á–∏ –º–∞—Å—Å–∏–≤–∞ –Ω–∞—á–∏–Ω–∞–ª–∏—Å—å —Å 1 –≤–º–µ—Å—Ç–æ 0

---

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω `api/index.php`

**–§–∞–π–ª**: `/api/index.php`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1** - –î–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç –¥–ª—è `payment-methods`:
```php
// –ë—ã–ª–æ:
elseif ($pathParts[0] === 'payment') {
    require_once __DIR__ . '/endpoints/payment.php';
}

// –°—Ç–∞–ª–æ:
elseif ($pathParts[0] === 'payment' || $pathParts[0] === 'payment-methods') {
    require_once __DIR__ . '/endpoints/payment.php';
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞:
```php
// –ë—ã–ª–æ:
$pathParts = array_filter(explode('/', $path));

// –°—Ç–∞–ª–æ:
$pathParts = array_values(array_filter(explode('/', $path)));
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- `array_filter()` —É–¥–∞–ª—è–µ—Ç –ø—É—Å—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–ª—é—á–∏
- –ë–µ–∑ `array_values()` –º–∞—Å—Å–∏–≤ –º–æ–≥ –±—ã—Ç—å: `[1 => 'payment', 2 => 'init']`
- –° `array_values()` –º–∞—Å—Å–∏–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `[0 => 'payment', 1 => 'init']`

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ —á–µ—Ä–µ–∑ curl:
```bash
curl http://your-domain.com/api/payment-methods/active
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "code": "kaspi_gold",
      "name": "Kaspi Gold",
      "type": "wallet",
      "provider": "Kaspi",
      "commission_percent": "1.00",
      ...
    },
    ...
  ]
}
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–ø–ª–∞—Ç—ã

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂ –≤ –∞–¥–º–∏–Ω–∫–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É `/pay/{transaction_id}`
3. –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –≤—Å–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:
   - üí∞ Kaspi Gold (1% –∫–æ–º–∏—Å—Å–∏—è)
   - üí≥ Kaspi Red (1% –∫–æ–º–∏—Å—Å–∏—è)
   - üè¶ Kaspi –ö—Ä–µ–¥–∏—Ç (14% –≥–æ–¥–æ–≤—ã—Ö)
   - üìÖ Kaspi —Ä–∞—Å—Å—Ä–æ—á–∫–∞ 0-0-12
   - üìÜ Kaspi —Ä–∞—Å—Å—Ä–æ—á–∫–∞ 0-0-24

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console
–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞:
- `404 Not Found` –¥–ª—è `/api/payment-methods/active`
- `Failed to load payment methods`

---

## üì¶ –î–µ–ø–ª–æ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (—Ç–æ–ª—å–∫–æ backend)

–ï—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `api/index.php`:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `/path/to/web/root/api/index.php`
2. –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
   ```php
   elseif ($pathParts[0] === 'payment') {
   ```
3. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞:
   ```php
   elseif ($pathParts[0] === 'payment' || $pathParts[0] === 'payment-methods') {
   ```
4. –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
   ```php
   $pathParts = array_filter(explode('/', $path));
   ```
5. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞:
   ```php
   $pathParts = array_values(array_filter(explode('/', $path)));
   ```
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª
7. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã - –¥–æ–ª–∂–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å!

### –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `deploy.zip`:

```bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–π deploy.zip –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# 2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ (–ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Ñ–∞–π–ª—ã)
unzip -o deploy.zip -d /path/to/web/root/

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
curl http://your-domain.com/api/payment-methods/active
```

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å?

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
```sql
SELECT COUNT(*) FROM payment_methods WHERE is_active = 1;
```
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –æ–ø–ª–∞—Ç—ã.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PHP
```bash
tail -f /var/log/php-fpm/error.log
# –∏–ª–∏
tail -f /var/log/apache2/error.log
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
```bash
ls -la /path/to/web/root/api/index.php
```
–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 4**: –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à PHP OPcache (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PHP-FPM
sudo systemctl restart php-fpm

# –ò–ª–∏ Apache
sudo systemctl restart apache2
```

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–æ—É—Ç–∏–Ω–≥

**–ó–∞–ø—Ä–æ—Å**: `GET /api/payment-methods/active`

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```php
// 1. –ü–æ–ª—É—á–∞–µ–º URI
$requestUri = '/api/payment-methods/active'

// 2. –£–¥–∞–ª—è–µ–º /api/
$path = 'payment-methods/active'

// 3. –†–∞–∑–±–∏–≤–∞–µ–º –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º
explode('/', $path)        // ['', 'payment-methods', 'active']
array_filter(...)          // [1 => 'payment-methods', 2 => 'active']  ‚ùå –ü–†–û–ë–õ–ï–ú–ê
array_values(...)          // [0 => 'payment-methods', 1 => 'active']  ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û

// 4. –†–æ—É—Ç–∏–Ω–≥
if ($pathParts[0] === 'payment-methods') {  // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
    require 'endpoints/payment.php';
}

// 5. –í payment.php
if ($pathParts[0] === 'payment-methods' && $pathParts[1] === 'active') {  // ‚úÖ
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã
}
```

---

## üéØ –ò—Ç–æ–≥

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ –†–æ—É—Ç–∏–Ω–≥ –¥–ª—è `/api/payment-methods/active`
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞ `$pathParts`
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–ª–∏–µ–Ω—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ
- ‚úÖ API —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–æ—Å–æ–±—ã
- ‚úÖ –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã
- ‚úÖ –í—Å–µ –¥—Ä—É–≥–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ê—Ä—Ö–∏–≤
- üì¶ `deploy.zip` –æ–±–Ω–æ–≤–ª–µ–Ω —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
- üìù –†–∞–∑–º–µ—Ä: 1.4 MB
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã (Ctrl+F5)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
3. ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
4. ‚úÖ –ü—Ä–æ–π–¥–∏—Ç–µ –≤–µ—Å—å —Ñ–ª–æ—É –æ–ø–ª–∞—Ç—ã
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!** üéâ

---

**–í–µ—Ä—Å–∏—è**: 2.0.1 (hotfix)  
**–§–∞–π–ª—ã**: api/index.php  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í–´–°–û–ö–ò–ô  
**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: < 5 –º–∏–Ω—É—Ç

