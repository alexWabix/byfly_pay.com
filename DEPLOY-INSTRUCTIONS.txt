╔═══════════════════════════════════════════════════════════════╗
║   ByFly Payment Center - Инструкция по деплою v2.0           ║
║   Дата: 25.12.2025                                           ║
╚═══════════════════════════════════════════════════════════════╝

📦 ФАЙЛ ДЛЯ ЗАГРУЗКИ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Файл: deploy.zip
Размер: 144 KB (сжатый), 402 KB (распакованный)
Файлов: 56

🚀 БЫСТРЫЙ ДЕПЛОЙ (5 минут)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. ЗАГРУЗИТЕ АРХИВ НА СЕРВЕР
   - Используйте FTP, SFTP или панель хостинга
   - Загрузите deploy.zip в корневую директорию сайта

2. РАСПАКУЙТЕ АРХИВ
   
   Через SSH:
   cd /path/to/your/site
   unzip -o deploy.zip
   rm deploy.zip
   
   Или через панель хостинга:
   - Найдите deploy.zip в файловом менеджере
   - Нажмите "Распаковать" / "Extract"
   - Удалите deploy.zip после распаковки

3. ОБНОВИТЕ БАЗУ ДАННЫХ
   
   mysql -u payments -p payments < database/migration-client-info.sql
   
   Пароль: 2350298aweA
   
   Это добавит поля для аналитики клиентов.

4. ПРОВЕРЬТЕ РАБОТУ
   
   Откройте: https://byfly-pay.com/test-payment-methods-api.html
   Нажмите: "Загрузить способы оплаты"
   
   ✅ Если появились 5 карточек - все работает!
   ❌ Если ошибка - см. раздел "Устранение проблем"

5. ПРОВЕРЬТЕ СТРАНИЦУ ОПЛАТЫ
   
   - Зайдите в админку: https://byfly-pay.com/
   - Перейдите в "Принять оплату"
   - Создайте тестовый платеж на 500₸
   - Откройте полученную ссылку в новой вкладке
   - Должны появиться способы оплаты!

✅ ГОТОВО! Система работает!

📋 ЧТО ВКЛЮЧЕНО В ОБНОВЛЕНИЕ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ Frontend (Vue.js):
   - PaymentPage.vue - публичная страница оплаты для клиентов
   - AcceptPayment.vue - обновленная страница создания платежей
   - Transactions.vue - детальная информация о платежах

✅ Backend (PHP):
   - api/index.php - ИСПРАВЛЕН роутинг для payment-methods
   - api/includes/Transaction.php - добавлен сбор данных о клиенте
   - api/endpoints/payment.php - публичные эндпоинты

✅ База данных:
   - migration-client-info.sql - новые поля для аналитики

✅ Тестовые файлы:
   - test-payment-methods-api.html - проверка API
   - test-api.html - общее тестирование

🔧 УСТРАНЕНИЕ ПРОБЛЕМ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ПРОБЛЕМА: Способы оплаты не загружаются
РЕШЕНИЕ:
1. Откройте: https://byfly-pay.com/api/payment-methods/active
2. Если 404 - файл api/index.php не обновлен
3. Перезагрузите deploy.zip и распакуйте снова
4. Очистите кеш браузера: Ctrl+Shift+R

ПРОБЛЕМА: Ошибка при распаковке архива
РЕШЕНИЕ:
1. Убедитесь что у вас есть права на запись
2. Проверьте что директория существует
3. Попробуйте распаковать через панель хостинга

ПРОБЛЕМА: Миграция БД не применяется
РЕШЕНИЕ:
1. Проверьте данные подключения к БД
2. Убедитесь что база данных "payments" существует
3. Выполните миграцию вручную через phpMyAdmin

ПРОБЛЕМА: Страница оплаты показывает 404
РЕШЕНИЕ:
1. Проверьте .htaccess файл в корне
2. Убедитесь что mod_rewrite включен
3. Проверьте права доступа к файлам (644 для файлов, 755 для папок)

📞 ПРОВЕРКА ПОСЛЕ ДЕПЛОЯ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[ ] Тест 1: API работает
    https://byfly-pay.com/api/payment-methods/active
    Должен вернуть JSON с методами

[ ] Тест 2: Админка доступна
    https://byfly-pay.com/
    Вход через SMS код

[ ] Тест 3: Создание платежа
    Админка → Принять оплату → Создать платеж
    Должна появиться ссылка и QR код

[ ] Тест 4: Страница оплаты работает
    Открыть ссылку из шага 3
    Должны появиться 5 способов оплаты

[ ] Тест 5: Данные клиента сохраняются
    Админка → Транзакции → Подробнее
    Должны быть IP, браузер, устройство

🎯 НОВЫЕ ВОЗМОЖНОСТИ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✨ Для клиентов:
   - Красивая страница выбора способа оплаты
   - Информация о комиссиях и условиях
   - Детали по кредитам и рассрочкам
   - Мобильная адаптация

✨ Для администраторов:
   - Генерация ссылки для клиента (вместо прямого Kaspi QR)
   - Полная аналитика: IP, браузер, устройство, ОС
   - Отслеживание: открыл/не открыл/оплатил
   - Детальная информация по каждой транзакции

✨ Готовность к расширению:
   - Легко добавлять новые платежные системы
   - Поддержка разных стран
   - Модульная архитектура

📊 СТРУКТУРА ФАЙЛОВ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

deploy.zip содержит:

/
├── index.html                          # Frontend (Vue.js)
├── assets/                             # JS/CSS файлы
├── api/                                # Backend (PHP)
│   ├── index.php                      # ⚠️ ГЛАВНЫЙ ФАЙЛ (с исправлениями!)
│   ├── config.php                     # Конфигурация БД
│   ├── init.php                       # Инициализация БД
│   ├── includes/                      # PHP классы
│   │   ├── Transaction.php            # ⚠️ Обновлен (аналитика клиентов)
│   │   ├── Database.php
│   │   ├── Auth.php
│   │   ├── KaspiTerminal.php
│   │   ├── JWT.php
│   │   └── Response.php
│   └── endpoints/                     # API эндпоинты
│       ├── payment.php                # ⚠️ Обновлен (публичные эндпоинты)
│       ├── admin.php
│       └── auth.php
├── database/
│   ├── schema.sql                     # Полная схема БД
│   └── migration-client-info.sql      # ⚠️ ВАЖНО! Применить миграцию
├── test-api.html                      # Тесты API
├── test-payment-methods-api.html      # ⚠️ НОВЫЙ! Тест способов оплаты
├── .htaccess                          # Apache конфиг
└── README.md                          # Документация

⚠️ ВАЖНЫЕ ФАЙЛЫ (обязательно обновить):
   1. api/index.php - исправлен роутинг
   2. database/migration-client-info.sql - применить миграцию
   3. api/includes/Transaction.php - добавлена аналитика
   4. api/endpoints/payment.php - публичные эндпоинты

💾 БЭКАП
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ПЕРЕД ОБНОВЛЕНИЕМ создайте бэкап:

1. Бэкап файлов:
   tar -czf backup-$(date +%Y%m%d).tar.gz *

2. Бэкап базы данных:
   mysqldump -u payments -p payments > backup-$(date +%Y%m%d).sql

📝 CHANGELOG
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Версия 2.0.1 (25.12.2025)

ИСПРАВЛЕНИЯ:
✅ Исправлен роутинг для /api/payment-methods/active
✅ Исправлена индексация массива $pathParts в api/index.php
✅ Добавлен тестовый файл для проверки API

НОВОЕ:
✅ Публичная страница оплаты /pay/{transaction_id}
✅ Сбор полной аналитики о клиентах
✅ Обновленная страница создания платежей
✅ Детальная информация в транзакциях

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎉 ГОТОВО! После деплоя система полностью готова к работе!

Документация: README.md, UPDATE-INSTRUCTIONS.md, CHANGELOG-v2.0.md
Поддержка: проверьте логи в database/transaction_logs

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

