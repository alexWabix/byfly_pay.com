# –î–µ–ø–ª–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π —Å SMS

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

### 1. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- Endpoint `/api/upload/document` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ PDF, DOC, DOCX, XLS, XLSX, JPG, PNG
- –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/uploads/documents/`
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB

### 2. ‚úÖ SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞–º
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ –∫–∞–∂–¥–æ–º—É –ø–æ–¥–ø–∏—Å–∞–Ω—Ç—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è SMS
- SMS —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—É–º–º—É –∏ —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è smsc.kz API

### 3. ‚úÖ –ü—É–±–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/approve-payment?token=XXX`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –ö–Ω–æ–ø–∫–∏ "–û–¥–æ–±—Ä–∏—Ç—å" –∏ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å"
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 4. ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS
- –ö–Ω–æ–ø–∫–∞ üì± –≤ —Å–ø–∏—Å–∫–µ –æ–ø–µ—Ä–∞—Ü–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è pending)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SMS –≤—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞–º —Å pending —Å—Ç–∞—Ç—É—Å–æ–º

## üóÑÔ∏è –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

**–í–ê–ñ–ù–û:** –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
mysql -u payments -p2350298aweA payments < database/migration-approval-tokens.sql
```

–≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è:
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `approval_token` –≤ —Ç–∞–±–ª–∏—Ü—É `payment_approvals`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

### Backend:
1. `api/endpoints/upload.php` - –¥–æ–±–∞–≤–ª–µ–Ω `/upload/document`
2. `api/endpoints/approvals.php`:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
   - `/approvals/payments/{id}/resend-sms` - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
   - `/approvals/payment-by-token/{token}` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ —Ç–æ–∫–µ–Ω—É (–ø—É–±–ª–∏—á–Ω—ã–π)
   - `/approvals/approve-by-token/{token}` - –æ–¥–æ–±—Ä–µ–Ω–∏–µ (–ø—É–±–ª–∏—á–Ω—ã–π)
   - `/approvals/reject-by-token/{token}` - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (–ø—É–±–ª–∏—á–Ω—ã–π)
3. `api/includes/Auth.php`:
   - `sendApprovalSms()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS –ø–æ–¥–ø–∏—Å–∞–Ω—Ç—É
   - `generateApprovalToken()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞

### Frontend:
1. `src/views/CreateOutgoingPayment.vue` - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. `src/views/ApprovalPayments.vue` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ SMS
3. `src/views/ApprovePayment.vue` - **–ù–û–í–ê–Ø** –ø—É–±–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è
4. `src/router/index.js` - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç `/approve-payment`

### Database:
- `database/migration-approval-tokens.sql` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

## üì± –§–æ—Ä–º–∞—Ç SMS —Å–æ–æ–±—â–µ–Ω–∏—è:

```
ByFly Pay: –ù–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
–û–ø–ª–∞—Ç–∞ –∑–∞ —É—Å–ª—É–≥–∏
–°—É–º–º–∞: 450 000 KZT
–ü–æ–¥–ø–∏—Å–∞—Ç—å: https://byfly-pay.com/approve-payment?token=abc123...
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- –ö–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω —É–Ω–∏–∫–∞–ª–µ–Ω (64 —Å–∏–º–≤–æ–ª–∞)
- –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
- –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å
- –ü—É–±–ª–∏—á–Ω—ã–µ endpoints –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é:

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ deploy.zip –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
2. **–†–∞—Å–ø–∞–∫—É–π—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å —Å–∞–π—Ç–∞**
3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î:**
   ```bash
   mysql -u payments -p2350298aweA payments < database/migration-approval-tokens.sql
   ```
4. **–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
   ```bash
   mkdir -p uploads/documents
   chmod 755 uploads/documents
   ```
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é SMS** –≤ `api/config.php`:
   ```php
   define('SMS_LOGIN', 'Byfly2024');
   define('SMS_PASSWORD', '2350298aweA!@');
   define('SMS_SENDER', 'ByFlyPay');
   ```

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂** —Å 2 –ø–æ–¥–ø–∏—Å–∞–Ω—Ç–∞–º–∏
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SMS** - –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–π—Ç–∏ –æ–±–æ–∏–º
3. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É** –∏–∑ SMS
4. **–ü–æ–¥–ø–∏—à–∏—Ç–µ –ø–ª–∞—Ç–µ–∂** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
5. **–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** - –∫–ª–∏–∫–Ω–∏—Ç–µ üì± –≤ —Å–ø–∏—Å–∫–µ

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î:
```sql
-- –°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ SMS
SELECT op.title, pa.admin_id, pa.sms_sent, pa.sms_sent_at, pa.status
FROM payment_approvals pa
JOIN outgoing_payments op ON pa.payment_id = op.id
ORDER BY pa.created_at DESC
LIMIT 20;

-- –¢–æ–∫–µ–Ω—ã
SELECT id, approval_token, status, sms_sent
FROM payment_approvals
WHERE created_at > DATE_SUB(NOW(), INTERVAL 1 DAY);
```

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **SMS –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ smsc.kz
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/log/php_errors.log`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ curl –≤–∫–ª—é—á–µ–Ω –≤ PHP

2. **–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ `/uploads/documents/`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `upload_max_filesize` –≤ php.ini
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `post_max_size` –≤ php.ini

3. **–°—Å—ã–ª–∫–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–æ—É—Ç `/approve-payment` –¥–æ—Å—Ç—É–ø–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .htaccess
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Vue —Ä–æ—É—Ç–µ—Ä –≤ —Ä–µ–∂–∏–º–µ history

## üìù –õ–æ–≥–∏:

–í—Å–µ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ SMS –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `error_log()`.
–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ PHP error log –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

---

**–í–µ—Ä—Å–∏—è:** 2.1.0  
**–î–∞—Ç–∞:** 26.12.2025  
**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** ByFly Travel Payment Center




